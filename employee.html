<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FedEx Leave System - Employee</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
  --fedex-purple: #4D148C;
  --fedex-orange: #FF6600;
  --bg-gray: #f4f4f6;
  --table-header-bg: #4D148C;
  --table-border: #ddd;
  --status-cancelled: #888888;
}

body {
  margin:0;
  font-family: Arial, sans-serif;
  background: var(--bg-gray);
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

header, footer {
  background: var(--fedex-purple);
  color:white;
  padding:12px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header .welcome {
  font-size:0.95em;
}

header button.logout {
  background: var(--fedex-orange);
  color:white;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}

main {
  flex:1;
  padding:20px 30px;
}

h2 {
  color: var(--fedex-purple);
  text-align:center;
  margin-bottom:20px;
}

/* ===== ADMIN-STYLE TOP LAYOUT (EMPLOYEE USE ONLY) ===== */
.top-controls {
  display:flex;
  flex-wrap:wrap;
  align-items:flex-end;
  gap:20px;
  background:#fff;
  padding:16px 20px;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,0.08);
  margin-bottom:20px;
}

.control-group {
  display:flex;
  flex-direction:column;
  font-size:0.85em;
}

.control-group label {
  font-weight:bold;
  margin-bottom:4px;
  color:#333;
}

.control-group select,
.control-group input {
  padding:8px 12px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:0.95em;
  min-width:180px;
}

.submit-inline {
  margin-top:22px;
  padding:10px 20px;
  background:var(--fedex-orange);
  color:white;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
  height:42px;
}

.submit-inline:hover {
  background:darkorange;
}

/* ===== TABLE ===== */
.card {
  background:white;
  padding:25px;
  border-radius:12px;
  box-shadow:0 6px 20px rgba(0,0,0,0.1);
}

table {
  width:100%;
  border-collapse:collapse;
  min-width:600px;
}

th, td {
  padding:12px;
  border-bottom:1px solid var(--table-border);
}

th {
  background:var(--table-header-bg);
  color:white;
}

.status-Pending { color:orange; font-weight:bold; }
.status-Approved { color:green; font-weight:bold; }
.status-Rejected { color:red; font-weight:bold; }
.status-Cancelled {
  color:var(--status-cancelled);
  font-style:italic;
  font-weight:bold;
}

/* Mobile */
@media(max-width:768px){
  .top-controls {
    flex-direction:column;
    align-items:stretch;
  }
  .control-group select,
  .control-group input {
    min-width:100%;
  }
  .submit-inline {
    width:100%;
  }
}

/* table allignment */
table {
  width: 100%;
  border-collapse: collapse;
  min-width: 600px;
  table-layout: fixed; /* FIXES COLUMN ALIGNMENT */
}

th, td {
  padding: 12px;
  border-bottom: 1px solid var(--table-border);
  text-align: left;
  word-wrap: break-word; /* Wrap long text */
  overflow-wrap: break-word; /* Wrap long text in all browsers */
}

td.reason-col {
  max-width: 250px; /* Restrict Reason column width */
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

<header>
  <span class="welcome" id="welcomeMsg">Welcome</span>
  <button class="logout" onclick="logout()">
    <i class="fas fa-sign-out-alt"></i> Logout
  </button>
</header>

<main>
  <h2 id="userName">Welcome!</h2>

  <!-- TOP CONTROLS = FILE LEAVE REQUEST -->
  <div class="top-controls">
    <div class="control-group">
      <label for="type">Leave Type</label>
      <select id="type">
        <option>Vacation</option>
        <option>CTO</option>
        <option>RDCO</option>
      </select>
    </div>

    <div class="control-group">
      <label for="date">Leave Date</label>
      <input type="date" id="date">
    </div>

    <div class="control-group" style="flex:1">
      <label for="reason">Reason</label>
      <input type="text" id="reason" placeholder="Enter reason">
    </div>

    <button class="submit-inline" id="submitBtn">
      Submit Leave
    </button>
  </div>

  <div class="card">
    <h3>My Leave Tickets</h3>
    <table id="table">
      <tr>
        <th>Type</th>
        <th>Date</th>
        <th>Reason</th>
        <th>Status</th>
        <th>Submitted Date</th>
      </tr>
    </table>
  </div>
</main>

<footer>Â© FedEx 2026</footer>

<!-- ðŸ”’ SCRIPT â€” LEFT COMPLETELY UNCHANGED -->
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAFedbBDXSZomKX8MQkBfVBRfi6tl0LTcc",
  authDomain: "fedex-attendance-system.firebaseapp.com",
  projectId: "fedex-attendance-system",
  storageBucket: "fedex-attendance-system.firebasestorage.app",
  messagingSenderId: "1049424874301",
  appId: "1:1049424874301:web:f94559159b19ee39c19354"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Check login
const currentUser = JSON.parse(localStorage.getItem("currentUser"));
if(!currentUser){ 
  alert("Please login first"); 
  location.href="index.html"; 
} 
document.getElementById("userName").textContent = `Welcome! ${currentUser.name} to Employee Page`;
document.getElementById("welcomeMsg").textContent = `Welcome ${currentUser.name} to Employee Page`;

// Logout
function logout() {
  if(confirm("Are you sure you want to logout?")){
    localStorage.removeItem("currentUser");
    location.href="index.html";
  }
}

// Elements
const typeEl = document.getElementById("type");
const dateEl = document.getElementById("date");
const reasonEl = document.getElementById("reason");
const submitBtn = document.getElementById("submitBtn");

// Submit leave request
submitBtn.addEventListener("click", async ()=>{
  if(!dateEl.value || !reasonEl.value){ 
    alert("Complete all fields"); 
    return; 
  }

  const now = new Date();
  const leaveData = {
    employeeId: currentUser.id,
    employeeName: currentUser.name,
    type: typeEl.value,
    date: dateEl.value,
    reason: reasonEl.value,
    status: "Pending",
    submittedAt: now
  };

  try{
    await db.collection("single_day_leave").add(leaveData);
    alert("Leave request submitted!");
    dateEl.value = "";
    reasonEl.value = "";
  } catch(err){ alert("Error submitting leave: "+err.message); }
});

// Load leaves
function loadLeaves() {
  const tableEl = document.getElementById("table");
  db.collection("single_day_leave")
    .where("employeeId","==",currentUser.id)
    .onSnapshot(snapshot => {
      tableEl.innerHTML = `<tr>
        <th>Type</th><th>Date</th><th>Reason</th><th>Status</th><th>Submitted Date</th>
      </tr>`;
      
      snapshot.forEach(doc => {
        const l = doc.data();
        const id = doc.id;

        let submittedDate = l.submittedAt && l.submittedAt.toDate ? l.submittedAt.toDate() : new Date(l.submittedAt);

        const dateStr = submittedDate.toLocaleString("en-PH",{
          timeZone:"Asia/Manila",
          year:"numeric", month:"short", day:"numeric",
          hour:"2-digit", minute:"2-digit", second:"2-digit"
        });

        let actions = '';
        if(l.status==="Pending"){
          actions = `<button class="cancel" onclick="cancelLeave('${id}')"></button>`;
        }

       tableEl.innerHTML += `<tr>
  <td>${l.type}</td>
  <td>${l.date}</td>
  <td class="reason-col">${l.reason}</td> <!-- ADD CLASS -->
  <td class="status-${l.status}">${l.status}</td>
  <td>${dateStr}</td>
</tr>`;
      });
    }, err => { alert("Error loading leaves: "+err.message); });
}


loadLeaves();
</script>

</body>
</html>

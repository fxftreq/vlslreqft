<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FedEx Leave System - Employee</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
  --fedex-purple:#4D148C;
  --fedex-orange:#FF6600;
  --bg-gray:#f5f7fa;
}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--bg-gray);
  display:flex;
  flex-direction:column;
  min-height:100vh;
}
header,footer{
  background:var(--fedex-purple);
  color:white;
  padding:12px 20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
header .welcome{
  flex:1;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
header button.logout{
  background:var(--fedex-orange);
  color:white;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
}
main{ flex:1; padding:20px; }
h2{ color:var(--fedex-purple); text-align:center; }
.card{
  background:white;
  padding:25px;
  border-radius:12px;
  box-shadow:0 6px 20px rgba(0,0,0,.1);
  margin-bottom:20px;
}
label{ font-weight:600; margin-top:10px; display:block; }
input,select,textarea{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:6px;
  border:1px solid #ccc;
  box-sizing:border-box;
}
textarea{ resize:vertical; }
button.submit{
  width:100%;
  padding:12px;
  margin-top:12px;
  background:var(--fedex-orange);
  color:white;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
}
table{
  width:100%;
  border-collapse:collapse;
  min-width:600px;
}
th,td{
  border:1px solid #ddd;
  padding:10px;
}
th{
  background:var(--fedex-purple);
  color:white;
}
.status-Pending{ color:orange; font-weight:bold; }
.status-Approved{ color:green; font-weight:bold; }
.status-Rejected{ color:red; font-weight:bold; }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

<header>
  <span class="welcome" id="welcomeMsg">Welcome</span>
  <button class="logout" onclick="logout()">
    <i class="fas fa-sign-out-alt"></i> Logout
  </button>
</header>

<main>
<h2>TL Leave Request</h2>

<div class="card">
  <h3>File Leave Request</h3>

  <label>Leave Type</label>
  <select id="type">
    <option value="Vacation">Vacation</option>
    <option value="CTO">CTO</option>
    <option value="RDCO">RDCO</option>
  </select>

  <label>Leave Date</label>
  <input type="date" id="date">

  <label>Reason</label>
  <textarea id="reason"></textarea>

  <button class="submit" id="submitBtn">Submit Leave</button>
</div>

<div class="card">
  <h3>My Leave Tickets</h3>
  <table id="table">
    <tr>
      <th>Type</th>
      <th>Date</th>
      <th>Reason</th>
      <th>Status</th>
      <th>Submitted At</th>
    </tr>
  </table>
</div>
</main>

<footer>Â© FedEx 2026</footer>

<script>
// Firebase
firebase.initializeApp({
  apiKey:"AIzaSyAFedbBDXSZomKX8MQkBfVBRfi6tl0LTcc",
  authDomain:"fedex-attendance-system.firebaseapp.com",
  projectId:"fedex-attendance-system"
});
const db=firebase.firestore();

// login
const currentUser = JSON.parse(localStorage.getItem("currentUser"));
if(!currentUser){ 
  alert("Please login first"); 
  location.href="index.html"; 
} 
document.getElementById("userName").textContent = `Welcome! ${currentUser.name} to Employee Page`;
document.getElementById("welcomeMsg").textContent = `Welcome ${currentUser.name} to Employee Page`;

// Logout
function logout(){
  if(confirm("Logout?")){
    localStorage.removeItem("currentUser");
    location.href="index.html";
  }
}

// Submit leave
document.getElementById("submitBtn").onclick=async ()=>{
  if(!date.value || !reason.value){
    alert("Complete all fields");
    return;
  }
  await db.collection("single_day_leave").add({
    employeeId:currentUser.id,
    employeeName:currentUser.name,
    type:type.value,
    date:date.value,
    reason:reason.value,
    status:"Pending",
    submittedAt:new Date()
  });
  alert("Leave submitted");
  date.value=""; reason.value="";
};

// Load leaves
db.collection("single_day_leave")
.where("employeeId","==",currentUser.id)
.onSnapshot(snap=>{
  table.innerHTML=`<tr>
    <th>Type</th>
    <th>Date</th>
    <th>Reason</th>
    <th>Status</th>
    <th>Submitted At</th>
  </tr>`;
  snap.forEach(doc=>{
    const l=doc.data();
    const d=l.submittedAt?.toDate?.() || new Date(l.submittedAt);
    table.innerHTML+=`
      <tr>
        <td>${l.type}</td>
        <td>${l.date}</td>
        <td>${l.reason}</td>
        <td class="status-${l.status}">${l.status}</td>
        <td>${d.toLocaleString("en-PH",{timeZone:"Asia/Manila"})}</td>
      </tr>`;
  });
});
</script>

</body>
</html>

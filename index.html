<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FedEx Leave System | Login</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --fedex-purple:#4D148C;
  --fedex-orange:#FF6600;
  --border:#d1d5db;
  --bg:#f3f4f6;
}
*{ box-sizing:border-box; }

body{
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(-45deg, #4D148C, #FF6600, #4D148C, #FF6600);
  background-size: 400% 400%;
  animation: gradientAnimation 15s ease infinite;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

@keyframes gradientAnimation {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* LOGIN CARD */
.login-card{
  background: rgba(255,255,255,0.95);
  width:100%;
  max-width:420px;
  padding:32px 28px;
  border-radius:6px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  backdrop-filter: blur(10px);
}

.logo{text-align:center; margin-bottom:18px;}
.logo img{height:38px;}

.purple-id{text-align:center; font-weight:bold; color:#666; margin-bottom:20px;}

label{ font-size:.85em; font-weight:bold; color:#333; }
input, select{
  width:100%;
  padding:12px;
  margin-top:6px;
  margin-bottom:14px;
  border:1px solid var(--border);
  border-radius:4px;
  font-size:.95em;
}

input:focus, select:focus{
  outline:none;
  border-color:var(--fedex-purple);
  box-shadow:0 0 0 2px rgba(77,20,140,.15);
}

button{
  width:100%;
  padding:12px;
  background:var(--fedex-purple);
  border:none;
  color:#fff;
  font-weight:bold;
  border-radius:4px;
  cursor:pointer;
  margin-top:8px;
}
button:hover{ background:#3e0f72; }

.links{ margin-top:16px; font-size:.85em; }
.links a{ display:block; color:#5b21b6; text-decoration:none; margin-top:6px; }
.links a:hover{ text-decoration:underline; }

#error{ margin-top:10px; color:#dc2626; font-size:.85em; text-align:center; }

.password-wrapper{ position:relative; }
.password-wrapper i{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  color:#6b7280;
  font-size:.95em;
}
.password-wrapper i:hover{ color:var(--fedex-purple); }
</style>
</head>

<body>

<div class="login-card">

  <div class="logo">
   <img src="fedex.png" alt="FedEx Logo" style="height:150px;">
  </div>

  <div class="purple-id">Login</div>

  <label>Username</label>
  <input type="text" id="username" placeholder="Enter your username">

  <label>Password</label>
  <div class="password-wrapper">
    <input type="password" id="password" placeholder="Enter your password">
    <i class="fa-solid fa-eye" id="togglePassword"></i>
  </div>

  <label>Login As</label>
  <select id="loginType">
    <option value="team_leader">Team Leader</option>
    <option value="manager">Manager</option>
  </select>

  <button id="loginBtn">Next</button>
  <div id="error"></div>

  <div class="links">
    <a href="#" id="forgotPasswordLink">Forgot Password?</a>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAFedbBDXSZomKX8MQkBfVBRfi6tl0LTcc",
  authDomain: "fedex-attendance-system.firebaseapp.com",
  projectId: "fedex-attendance-system",
  storageBucket: "fedex-attendance-system.firebasestorage.app",
  messagingSenderId: "1049424874301",
  appId: "1:1049424874301:web:f94559159b19ee39c19354"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const loginBtn = document.getElementById("loginBtn");
const togglePassword = document.getElementById("togglePassword");
const passwordInput = document.getElementById("password");
const error = document.getElementById("error");

// Show/hide password
togglePassword.addEventListener("click", ()=>{
  const hidden = passwordInput.type === "password";
  passwordInput.type = hidden ? "text" : "password";
  togglePassword.classList.toggle("fa-eye");
  togglePassword.classList.toggle("fa-eye-slash");
});

// Login button
loginBtn.addEventListener("click", async ()=>{
  error.textContent = "";
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const role = document.getElementById("loginType").value;

  if(!username || !password || !role){
    error.textContent = "Please complete all fields.";
    return;
  }

  try{
    let collectionName = role === "team_leader" ? "leave_users" : "manager_leave_user";
    const docRef = db.collection(collectionName).doc(username);
    const docSnap = await docRef.get();

    if(!docSnap.exists){
      error.textContent = `${role === "team_leader" ? "User" : "Manager"} not found.`;
      return;
    }

    const userData = docSnap.data();

    // Use tempPassword for both collections
    const storedPassword = userData.tempPassword;
    if(!storedPassword){
      error.textContent = "User has no password set.";
      return;
    }

    if(password !== storedPassword){
      error.textContent = "Incorrect password.";
      return;
    }

    // Save user to localStorage
    localStorage.setItem("currentUser", JSON.stringify({...userData,id:docSnap.id}));

    // ROUTING
    if(role === "team_leader"){
      location.href = userData.role === "admin" ? "admin.html" : "employee.html";
    } else {
      // Manager
      location.href = userData.managerLevel === "admin" ? "manager-admin.html" : "manager-employee.html";
    }

  } catch(err){
    error.textContent = err.message;
  }
});
</script>

</body>
</html>
